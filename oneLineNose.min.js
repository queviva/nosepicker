document.querySelectorAll('[data-nose]').forEach((N,v)=>

{
    v=N.vals=(N.dataset.vals?JSON.parse(N.dataset.vals):{h:0,s:100,l:50,a:1,sns:500,low:50}),
    
    G=(...v)=>v.sort((a,b)=>a-b)[1];

    N.addEventListener('wheel',
        (
            e,
            K = e.ctrlKey,
            R = e.shiftKey ? v.sns : v.low,
            X = e.wheelDeltaX,
            Y = e.wheelDeltaY,
            z = e.preventDefault() + e.stopPropagation()
            
        ) => N.dispatchEvent(new CustomEvent('nose-input', {
            
            detail: {
                
                color: (N.value = N.style.backgroundColor = 'hsla(' + (v.h = K ? v.h : v.h - Y / R) + ',' + (v.s = K ? G(v.s + Y / R, 100, 0) : v.s) + '%,' + (v.l = K ? v.l : G(v.l + X / R, 100, 0)) + '%,' + (v.a = K ? G(v.a - X / R * 0.01, 1, 0) : v.a) + ')'),
                
                vals: v
            },
            
            I: (N.style.backgroundImage = `repeating-linear-gradient(-45deg,rgba(0,0,0,${.5-v.a/2}),rgba(0,0,0,${.5-v.a/2})10px,transparent 10px,transparent 20px)`)
            
        })));

    N.addEventListener('click', e => N.dispatchEvent(new CustomEvent('nose-change', { detail: { color: N.style.backgroundColor, vals: v } })));

});